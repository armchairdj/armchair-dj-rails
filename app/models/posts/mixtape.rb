# frozen_string_literal: true

class Mixtape < Post

  #############################################################################
  # CONCERNS.
  #############################################################################

  #############################################################################
  # SCOPES.
  #############################################################################

  scope :eager, -> { includes(:author, :tags, :playlist, :playlistings, :works, :creators, :contributors, :aspects).references(:author) }

  #############################################################################
  # ASSOCIATIONS.
  #############################################################################

  belongs_to :playlist

  has_many :playlistings, through: :playlist
  has_many :works,        through: :playlistings

  has_many :creators,      through: :works
  has_many :contributors,  through: :works
  has_many :aspects,       through: :works

  #############################################################################
  # ATTRIBUTES.
  #############################################################################

  #############################################################################
  # VALIDATIONS.
  #############################################################################

  validates :playlist, presence: true

  #############################################################################
  # HOOKS.
  #############################################################################

  #############################################################################
  # SLUGGABLE.
  #############################################################################

  def sluggable_parts
    playlist.try(:sluggable_parts) || []
  end

  #############################################################################
  # INSTANCE: TYPE METHODS.
  #############################################################################

  def type(plural: false)
    plural ? "Mixtapes" : "Mixtape"
  end

  #############################################################################
  # INSTANCE.
  #############################################################################

  def alpha_parts
    playlist.try(:alpha_parts) || []
  end

  def cascade_viewable
    super

    playlist.cascade_viewable
  end
end
