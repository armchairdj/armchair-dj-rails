<%
  records = f.object.group_memberships
  error   = f.error(:group_memberships)
  classes = join_attr("fields-for", "toggle", ("fieldset-with-errors" if error))
%>

<%= content_tag(:fieldset, js_togglable_attrs(true, classes, expandable: true)) do %>
  <%= content_tag(:legend, "Groups") %>

  <%= content_tag(:div, error, class: "legend-hint") if error %>

  <%= render partial: "group_membership", collection: records, locals: { f: f } %>
<% end %>
