<%
  form_attrs = { class: "admin" }

  if @work.new_record?
    form_attrs.merge!({ "data-controller": "auto-submittable" })
  end
%>

<%= simple_form_for([:admin, @work.becomes(Work)], html: form_attrs) do |f| %>
  <% f.object = @work.becomes(@work.class) %>
  <%= f.error_notification %>

  <%= content_tag(:div, class: "form-inputs") do %>
    <%= content_tag(:section, class: "adj-module") do %>
      <%= content_tag(:fieldset) do %>
        <% if f.object.persisted? %>
          <%= f.input :type, as: :select, collection: @types, disabled: true %>
        <% else %>
          <%= f.input :type, as: :select, collection: @types, input_html: {
            "data-controller": "selectable",
            "data-target":     "auto-submittable.field"
          } %>
        <% end %>

        <%= f.input :title %>

        <%= f.input :subtitle, required: false, hint: true, placeholder: true %>

        <%= f.input :parent_id, as: :grouped_select,
          collection:         @works,
          selected:           f.object.parent_id,
          required:           false,
          group_label_method: :first,
          group_method:       :last,
          label_method:       :full_display_title,
          value_method:       :id,
          include_blank:      :translate,
          input_html:         { "data-controller": "selectable" }
        %>
      <% end %>

      <%= render partial: "credit_fieldset", locals: { f: f } %>

      <%= render partial: "contribution_fieldset", locals: { f: f } %>

      <%= render partial: "admin/shared/forms/link_fieldset", locals: { f: f } %>

      <%= render partial: "admin/shared/forms/displayable_fieldset", locals: { f: f } %>
    <% end %>
  <% end %>

  <%= content_tag(:div, class: "button-group") do %>
    <%= admin_submit_button(f) %>

    <%= f.button(:button, "Update Medium", type: :submit,
      name: "step", value: "select_work_type", class: "secondary",
      "data-target": "auto-submittable.button"
    ) if f.object.new_record? %>
  <% end %>
<% end %>
