<%
  headline = association.to_s.capitalize if local_assigns[:headline].nil?
  required = false                       if local_assigns[:required].nil?

  singular = association.to_s.singularize
  records  = f.object.send(association)
  error    = f.error(association)
  classes  = join_attr("legendary", "fields-for", ("fieldset-with-errors" if error))
  partial  = "admin/#{f.object.model_name.plural}/fieldset_#{singular}"
%>

<%= content_tag(:section, class: "adj-module") do %>
  <%= content_tag(:fieldset, class: classes, "data-controller": "expandable-fieldset") do %>
    <%= content_tag(:legend) do %>
      <%= headline %>
      <%= required_indicator if required %>
    <% end %>

    <%= content_tag(:div, error, class: "legend-hint") if error %>

    <%= render partial: partial, collection: records, as: singular, locals: { f: f } %>
  <% end %>
<% end %>
