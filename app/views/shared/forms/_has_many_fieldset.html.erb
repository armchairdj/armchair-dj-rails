<%
  headline  = association.to_s.capitalize if local_assigns[:headline ].nil?
  view_path = f.object.model_name.plural  if local_assigns[:view_path].nil?
  required  = false                       if local_assigns[:required ].nil?
  hint      = nil                         if local_assigns[:hint     ].nil?

  singular  = association.to_s.singularize
  records   = f.object.send(association)
  error     = f.error(association)
  hint_text = error || hint
  classes   = join_attr("fields-for", ("fieldset-with-errors" if error))
  partial   = "admin/#{view_path}/fieldset_#{singular}"
%>

<%= adj_module do %>
  <%= content_tag(:fieldset, class: classes, "data-controller": "expandable-fieldset") do %>
    <%= content_tag(:legend) do %>
      <%= headline %>
      <%= required_indicator if required %>
    <% end %>

    <%= content_tag(:div, hint_text, class: "legend-hint") if hint_text %>

    <%= render partial: partial, collection: records, as: singular, locals: { f: f } %>
  <% end %>
<% end %>
